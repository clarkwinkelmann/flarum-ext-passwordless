(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var r in e)t.o(e,r)&&!t.o(s,r)&&Object.defineProperty(s,r,{enumerable:!0,get:e[r]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{TokenRequest:()=>v});const e=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/app"];var o=t.n(r);const n=flarum.core.compat["common/components/Button"];var a=t.n(n);const i=flarum.core.compat["forum/components/LogInModal"];var l=t.n(i);const d=flarum.core.compat["forum/components/SignUpModal"];var p=t.n(d);const c=flarum.core.compat["forum/components/ChangeEmailModal"];var u=t.n(c);function f(t,s){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},f(t,s)}const h=flarum.core.compat["common/app"];var w=t.n(h);const k=flarum.core.compat["common/Component"];var y=t.n(k);const b=flarum.core.compat["common/components/LoadingIndicator"];var g=t.n(b),v=function(t){var s,e;function r(){for(var s,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(s=t.call.apply(t,[this].concat(r))||this).sending=!1,s.sent=!1,s}e=t,(s=r).prototype=Object.create(e.prototype),s.prototype.constructor=s,f(s,e);var o=r.prototype;return o.view=function(){return m(".PasswordlessTokenRequest",[m(".PasswordlessTokenRequest-send",[w().translator.trans("clarkwinkelmann-passwordless.lib.token-request."+(this.sent?"sent":"send"),{a:m("a",{onclick:this.requestPasswordlessToken.bind(this),disabled:this.sending})}),this.sending?[" ",g().component({display:"inline",size:"small"})]:null]),this.attrs.additionalText?m(".PasswordlessTokenRequest-more",this.attrs.additionalText):null])},o.requestPasswordlessToken=function(t){var s=this;t.preventDefault(),this.sending=!0,w().request({method:"POST",url:w().forum.attribute("apiUrl")+"/passwordless-request",body:{oneTimeToken:!0},errorHandler:this.attrs.errorHandler}).then((function(){s.sending=!1,s.sent=!0,s.attrs.onErrorClear&&s.attrs.onErrorClear(),m.redraw()})).catch((function(t){throw s.sending=!1,m.redraw(),t}))},r}(y()),S="clarkwinkelmann-passwordless.forum.sign-up.";o().initializers.add("clarkwinkelmann-passwordless",(function(){(0,e.extend)(l().prototype,"oninit",(function(){this.passwordlessTokenSent=!1,this.passwordlessSkip=!o().forum.attribute("passwordless.passwordlessLoginByDefault")})),(0,e.extend)(l().prototype,"fields",(function(t){this.passwordlessTokenSent?(t.add("passwordless",m("p",o().translator.trans(S+"link-sent",{a:m("a",{onclick:this.requestPasswordlessToken.bind(this)})})),100),t.has("identification")&&t.remove("identification"),t.has("remember")&&t.remove("remember"),t.has("submit")&&t.remove("submit")):this.passwordlessSkip||t.add("passwordless",m("p",o().translator.trans(S+"how-it-works")),-100),this.passwordlessSkip||(t.has("password")&&t.remove("password"),t.has("identification")&&t.get("identification")&&Array.isArray(t.get("identification").children)&&t.get("identification").children.forEach((function(t){t&&t.attrs&&"identification"===t.attrs.name&&(t.attrs.placeholder=o().translator.trans(S+"email"),t.attrs.type="email")})))})),(0,e.extend)(l().prototype,"footer",(function(t){var s=this;if(t){var e=Array.isArray(t)?t:t.children;Array.isArray(e)?(!this.passwordlessSkip&&e.length&&e[0]&&e[0].attrs&&"LogInModal-forgotPassword"===e[0].attrs.className&&e.splice(0,1),e.push(m("p",o().translator.trans(S+(this.passwordlessSkip?"login-without-password":"login-with-password"),{a:m("a",{onclick:function(){s.passwordlessSkip=!s.passwordlessSkip,s.passwordlessTokenSent=!1}})})))):console.warn("[passwordless] skipped LogInModal.footer")}})),l().prototype.requestPasswordlessToken=function(t){var s=this;t.preventDefault(),this.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/passwordless-request",body:{identification:this.identification(),remember:this.remember()},errorHandler:this.onerror.bind(this)}).then((function(){s.passwordlessTokenSent=!0,s.loaded()}),this.loaded.bind(this))},(0,e.override)(l().prototype,"onerror",(function(t,s){return 401===s.status&&s.alert&&!this.passwordlessSkip&&o().forum.attribute("allowSignUp")&&(s.alert.controls=s.alert.controls||[],s.alert.controls.unshift(o().translator.trans(S+"error-try-signup",{a:a().component({className:"Button Button--link",onclick:this.signUp.bind(this)})}))),t(s)})),(0,e.override)(l().prototype,"onsubmit",(function(t,s){if(this.passwordlessSkip)return t(s);this.requestPasswordlessToken(s)})),(0,e.extend)(p().prototype,"fields",(function(t){o().forum.attribute("passwordless.hideSignUpPassword")&&t.has("password")&&t.remove("password")})),(0,e.extend)(u().prototype,"fields",(function(t){var s=this;this.success||(t.has("email")&&t.setPriority("email",30),t.has("password")&&t.setPriority("password",20),t.add("passwordless-request",m(v,{errorHandler:this.onerror.bind(this),onErrorClear:function(){s.alertAttrs=null},additionalText:o().translator.trans("clarkwinkelmann-passwordless.forum.email-change-note")}),10))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map