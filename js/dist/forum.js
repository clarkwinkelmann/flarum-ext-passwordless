(()=>{var s={n:t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},d:(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},o:(s,t)=>Object.prototype.hasOwnProperty.call(s,t),r:s=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}},t={};(()=>{"use strict";s.r(t);const e=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/app"];var r=s.n(o);const n=flarum.core.compat["common/components/Button"];var a=s.n(n);const i=flarum.core.compat["forum/components/LogInModal"];var l=s.n(i);const d=flarum.core.compat["forum/components/SignUpModal"];var p=s.n(d),c="clarkwinkelmann-passwordless.forum.sign-up.";r().initializers.add("clarkwinkelmann-passwordless",(function(){(0,e.extend)(l().prototype,"oninit",(function(){this.passwordlessTokenSent=!1,this.passwordlessSkip=!r().forum.attribute("passwordless.passwordlessLoginByDefault")})),(0,e.extend)(l().prototype,"fields",(function(s){this.passwordlessTokenSent?(s.add("passwordless",m("p",r().translator.trans(c+"link-sent",{a:m("a",{onclick:this.requestPasswordlessToken.bind(this)})})),100),s.has("identification")&&s.remove("identification"),s.has("remember")&&s.remove("remember"),s.has("submit")&&s.remove("submit")):this.passwordlessSkip||s.add("passwordless",m("p",r().translator.trans(c+"how-it-works")),-100),this.passwordlessSkip||(s.has("password")&&s.remove("password"),s.has("identification")&&s.get("identification")&&Array.isArray(s.get("identification").children)&&s.get("identification").children.forEach((function(s){s&&s.attrs&&"identification"===s.attrs.name&&(s.attrs.placeholder=r().translator.trans(c+"email"),s.attrs.type="email")})))})),(0,e.extend)(l().prototype,"footer",(function(s){var t=this;if(s){var e=Array.isArray(s)?s:s.children;Array.isArray(e)?(!this.passwordlessSkip&&e.length&&e[0]&&e[0].attrs&&"LogInModal-forgotPassword"===e[0].attrs.className&&e.splice(0,1),e.push(m("p",r().translator.trans(c+(this.passwordlessSkip?"login-without-password":"login-with-password"),{a:m("a",{onclick:function(){t.passwordlessSkip=!t.passwordlessSkip,t.passwordlessTokenSent=!1}})})))):console.warn("[passwordless] skipped LogInModal.footer")}})),l().prototype.requestPasswordlessToken=function(s){var t=this;s.preventDefault(),this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/passwordless-request",body:{identification:this.identification(),remember:this.remember()},errorHandler:this.onerror.bind(this)}).then((function(){t.passwordlessTokenSent=!0,t.loaded()}),this.loaded.bind(this))},(0,e.override)(l().prototype,"onerror",(function(s,t){return 401===t.status&&t.alert&&!this.passwordlessSkip&&r().forum.attribute("allowSignUp")&&(t.alert.controls=t.alert.controls||[],t.alert.controls.unshift(r().translator.trans(c+"error-try-signup",{a:a().component({className:"Button Button--link",onclick:this.signUp.bind(this)})}))),s(t)})),(0,e.override)(l().prototype,"onsubmit",(function(s,t){if(this.passwordlessSkip)return s(t);this.requestPasswordlessToken(t)})),(0,e.extend)(p().prototype,"fields",(function(s){r().forum.attribute("passwordless.hideSignUpPassword")&&s.has("password")&&s.remove("password")}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map